Please see the code in branch refactor
